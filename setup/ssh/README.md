# SSH Key Generator

A comprehensive bash script for generating SSH keys with interactive prompts and automatic ssh-agent configuration.

## Description

This script simplifies the SSH key generation process by providing an interactive interface that guides users through creating secure SSH keys. It automatically configures ssh-agent to load on system boot and handles proper file permissions and validation.

### Features

- **Interactive prompts** for all key parameters
- **Multiple key types** supported (RSA, DSA, ECDSA, Ed25519)
- **Automatic ssh-agent configuration** for persistent key loading
- **Proper file permissions** and security measures
- **Input validation** and error handling
- **Coloured output** for better user experience
- **Existing key protection** with overwrite confirmation

## Prerequisites

### Dependencies

- **OpenSSH client** (`ssh-keygen`, `ssh-agent`, `ssh-add`)
- **Bash** (version 4.0 or higher)
- **Standard Unix utilities** (`grep`, `ps`, `wc`, `tr`)

### System Requirements

- Unix-like operating system (Linux, macOS, WSL)
- Home directory with write permissions
- Terminal with ANSI colour support (optional, but recommended)

## Installation

1. Download the script:
   ```bash
   curl -O https://example.com/ssh-key-generator.sh
   # or
   wget https://example.com/ssh-key-generator.sh
   ```

2. Make it executable:
   ```bash
   chmod +x ssh-key-generator.sh
   ```

3. Optionally, move to a directory in your PATH:
   ```bash
   sudo mv ssh-key-generator.sh /usr/local/bin/ssh-key-generator
   ```

## Usage

### Basic Usage

Run the script and follow the interactive prompts:

```bash
./ssh-key-generator.sh
```

### Configuration Options

The script will prompt for the following information:

| Prompt | Description | Default | Valid Options |
|--------|-------------|---------|---------------|
| Key Type | Cryptographic algorithm | `ed25519` | `rsa`, `dsa`, `ecdsa`, `ed25519` |
| Key Size | Bit length (RSA only) | `4096` | `â‰¥2048` (RSA only) |
| Filename | Key file location | `id_{keytype}` | Any valid path |
| Comment | Key identification | `user@host date` | Any string |

### Examples

#### Generate Ed25519 Key (Recommended)
```bash
$ ./ssh-key-generator.sh
Enter key type (rsa/dsa/ecdsa/ed25519) [default: ed25519]: 
Enter filename for the key [default: id_ed25519]: 
Enter comment for the key [default: alice@laptop 2024-01-15]: 
```

#### Generate RSA Key with Custom Settings
```bash
$ ./ssh-key-generator.sh
Enter key type (rsa/dsa/ecdsa/ed25519) [default: ed25519]: rsa
Enter RSA key size in bits [default: 4096]: 4096
Enter filename for the key [default: id_rsa]: work-server-key
Enter comment for the key [default: alice@laptop 2024-01-15]: alice@company.com work server
```

## Script Behaviour

### File Locations

- **SSH keys**: `~/.ssh/` (created if doesn't exist)
- **SSH config**: `~/.ssh/config`
- **Shell config**: `~/.bashrc` or `~/.profile`

### Permissions

The script automatically sets secure permissions:
- **Private keys**: `600` (owner read/write only)
- **Public keys**: `644` (owner read/write, others read only)
- **SSH directory**: `700` (owner full access only)

### SSH Agent Configuration

The script adds the following to your shell configuration:

```bash
# SSH Agent Configuration
if [ -z "$SSH_AUTH_SOCK" ]; then
    # Check for a currently running instance of the agent
    RUNNING_AGENT="$(ps -ax | grep 'ssh-agent -s' | grep -v grep | wc -l | tr -d '[:space:]')"
    if [ "$RUNNING_AGENT" = "0" ]; then
        # Launch a new instance of the agent
        ssh-agent -s &> "$HOME/.ssh/ssh-agent"
    fi
    eval "$(cat "$HOME/.ssh/ssh-agent")"
fi
```

## Security Considerations

### Production Deployment

For production environments, consider these additional security measures:

1. **Restrict script permissions**:
   ```bash
   chmod 750 ssh-key-generator.sh
   chown root:sysadmin ssh-key-generator.sh
   ```

2. **Enable auditing**:
   ```bash
   # Add to the script's log functions
   logger "SSH key generated by $USER from $SSH_CLIENT"
   ```

3. **Validate input sources**:
   - Ensure script integrity with checksums
   - Run from trusted locations only

4. **Monitor key generation**:
   - Log all key generation events
   - Alert on unusual patterns

### Key Type Recommendations

| Key Type | Security Level | Performance | Compatibility |
|----------|----------------|-------------|---------------|
| **Ed25519** | High | Excellent | Modern systems |
| **RSA 4096** | High | Good | Universal |
| **ECDSA** | High | Very Good | Modern systems |
| **RSA 2048** | Medium | Good | Universal (legacy) |

**Recommendation**: Use Ed25519 for new keys unless compatibility requires RSA.

## Troubleshooting

### Common Issues

#### Script Won't Execute
```bash
# Error: Permission denied
chmod +x ssh-key-generator.sh

# Error: Command not found
./ssh-key-generator.sh  # Use ./ prefix
```

#### SSH Tools Not Found
```bash
# Ubuntu/Debian
sudo apt-get install openssh-client

# CentOS/RHEL
sudo yum install openssh-clients

# macOS (usually pre-installed)
# If missing, install via Homebrew:
brew install openssh
```

#### SSH Agent Not Starting
```bash
# Manually start ssh-agent
eval "$(ssh-agent -s)"

# Check if already running
ps aux | grep ssh-agent

# Kill existing agents (if multiple)
pkill ssh-agent
```

#### Key Already Exists
The script will prompt before overwriting existing keys. If you need to:

- **Keep existing key**: Choose a different filename
- **Replace key**: Confirm overwrite when prompted
- **Backup first**: 
  ```bash
  cp ~/.ssh/id_ed25519 ~/.ssh/id_ed25519.backup
  cp ~/.ssh/id_ed25519.pub ~/.ssh/id_ed25519.pub.backup
  ```

#### Shell Configuration Issues
```bash
# If ssh-agent config wasn't added properly
source ~/.bashrc
# or
source ~/.profile

# Check current environment
echo $SSH_AUTH_SOCK
ssh-add -l
```

### Debug Mode

To run with verbose output:
```bash
bash -x ./ssh-key-generator.sh
```

### Log Analysis

Check system logs for ssh-related events:
```bash
# Linux
journalctl -u ssh-agent
tail -f /var/log/auth.log

# macOS
tail -f /var/log/system.log | grep ssh
```

## Advanced Usage

### Batch Key Generation

For multiple keys, you can run the script multiple times or create a wrapper:

```bash
#!/bin/bash
# generate-multiple-keys.sh

SERVERS=("web-server" "db-server" "backup-server")

for server in "${SERVERS[@]}"; do
    echo "Generating key for $server..."
    # Run with predefined inputs
done
```

### Integration with Configuration Management

The script can be integrated with tools like Ansible, Puppet, or Chef for automated deployment.

## Contributing

### Reporting Issues

1. Check existing issues first
2. Provide system information:
   ```bash
   uname -a
   bash --version
   ssh -V
   ```
3. Include exact error messages
4. Describe steps to reproduce

### Development

1. Fork the repository
2. Create a feature branch
3. Follow the existing code style
4. Add tests for new functionality
5. Update documentation
6. Submit a pull request

## License

This script is provided under the MIT License. See LICENSE file for details.

## Changelog

### Version 1.0.0
- Initial release
- Interactive key generation
- Automatic ssh-agent configuration
- Comprehensive error handling
- Security validations

---

**Note**: Always verify the integrity of SSH keys before using them in production environments. This script is provided as-is without warranty.
